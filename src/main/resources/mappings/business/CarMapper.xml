<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.root.cognition.business.dao.CarDao">

    <select id="get" resultType="com.root.cognition.business.entity.Car">
        SELECT
		 <include refid="carColumns"/>
        FROM business_car
        where
        car_id = #{value}
    </select>

    <select id="getByEntity" resultType="com.root.cognition.business.entity.Car">
        SELECT
        <include refid="carColumns"/>
        FROM business_car
        <where>
            del_flag = #{delFlag}
            <if test="carId !=null and carNum!=''">
                AND car_id = #{carId}
            </if>
            <if test="carNum !=null and carNum!=''">
                AND car_num = #{carNum}
            </if>
        </where>
    </select>

    <select id="findList" resultType="com.root.cognition.business.entity.Car">
        SELECT
        bc.car_id as `id`,
        bc.real_name,
        bc.identity_num,
        bc.mobile,
        bc.car_num,
        bc.car_type,
        bc.create_by,
        bc.update_by,
        bc.create_time,
        bc.update_time,
        bc.del_flag,
        bc.remarks
        from
        business_car bc
        left join business_car_user bcu ON bcu.car_id = bc.car_id
        <where>
            bc.del_flag = #{delFlag}
            and bcu.del_flag = #{delFlag}
            <if test="userId != null and userId != ''">
                and bcu.user_id = #{userId}
            </if>
            <if test="id != null and id != ''">
                and bc.car_id = #{id}
            </if>
            <if test="realName != null and realName != ''">
                and bc.real_name = #{realName}
            </if>
            <if test="identityNum != null and identityNum != ''">
                and bc.identity_num = #{identityNum}
            </if>
            <if test="mobile != null and mobile != ''">
                and bc.mobile = #{mobile}
            </if>
            <if test="carNum != null and carNum != ''">
                and bc.car_num = #{carNum}
            </if>
            <if test="carType != null and carType != ''">
                and bc.car_type = #{carType}
            </if>
            <if test="createBy != null and createBy != ''">
                and bc.create_by = #{createBy}
            </if>
            <if test="updateBy != null and updateBy != ''">
                and bc.update_by = #{updateBy}
            </if>
            <if test="createTime != null and createTime != ''">
                and bc.create_time = #{createTime}
            </if>
            <if test="updateTime != null and updateTime != ''">
                and bc.update_time = #{updateTime}
            </if>
            <if test="remarks != null and remarks != ''">
                and bc.remarks = #{remarks}
            </if>
        </where>
        <choose>
            <when test="sort != null and sort.trim() != ''">
                order by ${sort} ${order}
            </when>
            <otherwise>
                order by create_time desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="count" resultType="int">
        SELECT count(*) from business_car
        <where>
            <if test="id != null and id != ''">
                and car_id = #{id}
            </if>
            <if test="realName != null and realName != ''">
                and real_name = #{realName}
            </if>
            <if test="identityNum != null and identityNum != ''">
                and identity_num = #{identityNum}
            </if>
            <if test="mobile != null and mobile != ''">
                and mobile = #{mobile}
            </if>
            <if test="carNum != null and carNum != ''">
                and car_num = #{carNum}
            </if>
            <if test="carType != null and carType != ''">
                and car_type = #{carType}
            </if>
            <if test="createBy != null and createBy != ''">
                and create_by = #{createBy}
            </if>
            <if test="updateBy != null and updateBy != ''">
                and update_by = #{updateBy}
            </if>
            <if test="createTime != null and createTime != ''">
                and create_time = #{createTime}
            </if>
            <if test="updateTime != null and updateTime != ''">
                and update_time = #{updateTime}
            </if>
            <if test="delFlag != null and delFlag != ''">
                and del_flag = #{delFlag}
            </if>
            <if test="remarks != null and remarks != ''">
                and remarks = #{remarks}
            </if>
        </where>
    </select>

    <insert id="insert" parameterType="com.root.cognition.business.entity.Car">
		insert into business_car
		(
			`car_id`,
			`real_name`, 
			`identity_num`, 
			`mobile`, 
			`car_num`, 
			`car_type`,
			`create_by`, 
			`update_by`, 
			`create_time`, 
			`update_time`,
			`remarks`
		)
		values
		(
			#{id}, 
			#{realName}, 
			#{identityNum}, 
			#{mobile}, 
			#{carNum}, 
			#{carType},
			#{createBy}, 
			#{updateBy}, 
			#{createTime}, 
			#{updateTime},
			#{remarks}
		)
	</insert>

    <update id="update" parameterType="com.root.cognition.business.entity.Car">
        update business_car
        <set>
            <if test="realName != null">
                `real_name` = #{realName},
            </if>
            <if test="identityNum != null">
                `identity_num` = #{identityNum},
            </if>
            <if test="mobile != null">
                `mobile` = #{mobile},
            </if>
            <if test="carNum != null">
                `car_num` = #{carNum},
            </if>
            <if test="carType != null">
                `car_type` = #{carType},
            </if>
            <if test="createBy != null">
                `create_by` = #{createBy},
            </if>
            <if test="updateBy != null">
                `update_by` = #{updateBy},
            </if>
            <if test="createTime != null">
                `create_time` = #{createTime},
            </if>
            <if test="updateTime != null">
                `update_time` = #{updateTime},
            </if>
            <if test="delFlag != null">
                `del_flag` = #{delFlag},
            </if>
            <if test="remarks != null">
                `remarks` = #{remarks}
            </if>
        </set>
        where car_id = #{id}
    </update>

    <delete id="remove">
		update business_car set del_flag = '1' where car_id = #{value}
	</delete>

    <delete id="batchRemove">
        update business_car set del_flag = '1' where car_id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <sql id="carColumns">
		`car_id` as `id`,
		`real_name`,
		`identity_num`,
		`mobile`,
		`car_num`,
		`car_type`,
		`create_by`,
		`update_by`,
		`create_time`,
		`update_time`,
		`del_flag`,
		`remarks`
	</sql>
</mapper>